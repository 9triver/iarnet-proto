syntax = "proto3";
package ignis.actor;
option go_package = "github.com/9triver/iarnet/internal/proto/ignis/actor";

import "common/types.proto";
import "common/messages.proto";

// Actor 消息类型
// Actor 是执行单元，负责接收消息、执行函数、返回响应
enum MessageType {
  UNSPECIFIED = 0; // 未知消息类型
  ACK = 1; // 确认消息
  READY = 2; // Actor 就绪，可以接收消息
  FUNCTION = 3; // 函数定义消息，用于注册 Actor 要执行的函数
  INVOKE_REQUEST = 4; // 调用请求消息，包含函数参数
  INVOKE_RESPONSE = 5; // 调用响应消息，包含执行结果
}

// Function 消息：定义 Actor 要执行的函数
message Function {
  string Name = 1; // 函数名称
  repeated string Params = 2; // 函数参数列表
  repeated string Requirements = 3; // 函数依赖（Python 包）
  bytes PickledObject = 4; // 序列化的函数实现
  common.Language Language = 5; // 函数返回值的语言类型
}

// InvokeArg 是调用参数
message InvokeArg {
  string Param = 1; // 参数名称
  common.ObjectRef Value = 2; // 参数值（对象引用）
}

// InvokeRequest 是 Actor 调用请求
// 包含会话 ID 和所有参数
message InvokeRequest {
  string RuntimeID = 1; // Runtime ID
  repeated InvokeArg Args = 2; // 参数列表
}

// ActorInfo 包含 Actor 的延迟信息
// 用于负载均衡和调度决策
message ActorInfo {
  int64 CalcLatency = 2; // 计算延迟（毫秒）：函数执行时间
  int64 LinkLatency = 3; // 链路延迟（毫秒）：网络通信时间
}

// InvokeResponse 是 Actor 调用响应
// Actor 执行函数后返回的结果
message InvokeResponse {
  string RuntimeID = 1; // Runtime ID
  common.ObjectRef Result = 2; // 执行结果（对象引用）
  string Error = 3; // 错误信息（如果有）
  ActorInfo Info = 4; // Actor 延迟信息（用于负载均衡）
}

// Message 是 Actor 通信的消息封装
// Actor 通过 ZMQ 接收和发送这些消息
message Message {
  MessageType Type = 1; // 消息类型
  oneof Message {
    common.Ack Ack = 2; // 确认消息
    common.Ready Ready = 3; // 就绪消息
    Function Function = 4; // 函数定义消息
    InvokeRequest InvokeRequest = 5; // 调用请求消息
    InvokeResponse InvokeResponse = 6; // 调用响应消息
  }
}

