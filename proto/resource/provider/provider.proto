syntax = "proto3";
package provider;
option go_package = "github.com/9triver/iarnet/internal/proto/resource/provider";

import "resource/resource.proto";

message ProviderType {
  string name = 1;
}

message ConnectRequest {
  string provider_id = 1;
}

message ConnectResponse {
  bool success = 1;
  string error = 2;
  ProviderType provider_type = 3;
}

message GetCapacityRequest {
  string provider_id = 1; // 可选的 provider_id，用于鉴权
}

message GetCapacityResponse {
  resource.Capacity capacity = 1;
}

message GetAvailableRequest {
  string provider_id = 1; // 可选的 provider_id，用于鉴权
}

message GetAvailableResponse {
  resource.Info available = 1;
}

message DeployRequest {
  string instance_id = 1;
  string image = 2;
  resource.Info resource_request = 3;
  map<string, string> env_vars = 4;
  string provider_id = 5; // 可选的 provider_id，用于鉴权
}

message DeployResponse {
  string error = 1;
}

message HealthCheckRequest {
  string provider_id = 1; // 可选的 provider_id，用于鉴权
}

// ResourceTags 资源标签（描述 provider 支持的计算资源类型）
message ResourceTags {
  bool cpu = 1;     // 是否支持 CPU
  bool gpu = 2;     // 是否支持 GPU
  bool memory = 3;  // 是否支持内存
  bool camera = 4;  // 是否支持摄像头
}

message HealthCheckResponse {
  resource.Capacity capacity = 1;  // 当前资源使用情况（总容量、已使用、可用）
  ResourceTags resource_tags = 2;  // 所具有的资源类型
}

message DisconnectRequest {
  string provider_id = 1;
}

message DisconnectResponse {
}

message GetRealTimeUsageRequest {
  string provider_id = 1; // provider_id，用于鉴权
}

message GetRealTimeUsageResponse {
  resource.Info usage = 1; // 实时资源使用情况（CPU、内存、GPU）
}

service Service {
  rpc Connect(ConnectRequest) returns (ConnectResponse);
  rpc Disconnect(DisconnectRequest) returns (DisconnectResponse);
  rpc GetCapacity(GetCapacityRequest) returns (GetCapacityResponse);
  rpc GetAvailable(GetAvailableRequest) returns (GetAvailableResponse);
  rpc Deploy(DeployRequest) returns (DeployResponse);
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
  rpc GetRealTimeUsage(GetRealTimeUsageRequest) returns (GetRealTimeUsageResponse);
}
